# 将棋ゲーム (Python実装)

Pythonで実装した基本的な将棋ゲームです。コマンドライン版とPyGame版の両方が利用できます。

> **開発環境**: このプロジェクトは Amazon Q CLI を使用して開発されました。

## 機能

- 9x9の将棋盤
- 全ての駒の基本的な移動ルール
- 駒の成り機能
- 持ち駒システム
- ターン制のゲームプレイ
- **王手・詰みの判定** ✨ NEW!
- **勝利条件の実装** ✨ NEW!
- コマンドライン インターface（従来版）
- グラフィカル インターface（PyGame版）

## ファイル構成

- `shogi_game.py` - メインゲームファイル（コマンドライン版）
- `pygame_shogi.py` - PyGame版ゲームファイル
- `test_shogi.py` - テスト用ファイル
- `requirements.txt` - 依存関係
- `README.md` - このファイル

## セットアップ

### 仮想環境の作成とアクティベート

```bash
python3 -m venv venv
source venv/bin/activate  # macOS/Linux
# または
venv\Scripts\activate     # Windows
```

### 依存関係のインストール

```bash
pip install -r requirements.txt
```

## 使用方法

### コマンドライン版

```bash
python shogi_game.py
```

#### 操作方法

1. 移動は `77-76` の形式で入力します
   - 最初の2桁が移動元の座標
   - 後の2桁が移動先の座標
   - 座標は将棋の標準表記（9筋1段〜1筋9段）

2. 成りの判定
   - 敵陣（相手側3段）に入った駒は成ることができます
   - 成りの選択肢が表示されたら `y` または `n` で選択

3. 王手・詰みの表示
   - 王手状態の場合、警告メッセージが表示されます
   - 詰みの場合、勝者が表示されてゲームが終了します

4. ゲーム終了
   - `quit` と入力するとゲームを終了します

### PyGame版（グラフィカル版）

```bash
python pygame_shogi.py
```

#### 操作方法

1. **駒の選択**: 自分の駒をクリックして選択
2. **駒の移動**: 選択した駒の移動可能な場所（緑色でハイライト）をクリック
3. **成りの選択**: 成ることができる場合、ダイアログが表示されます
   - `Y`キー: 成る
   - `N`キー: 成らない
4. **王手・詰みの表示**: 画面上部に状態が表示されます
5. **ゲーム終了後**: `スペース`キーで再開、`ESC`キーで終了
6. **ゲーム終了**: `ESC`キーまたはウィンドウを閉じる

#### 画面の見方

- **赤い駒**: 後手（上向き）
- **黒い駒**: 先手（下向き）
- **黄色の枠**: 選択された駒
- **緑の枠**: 移動可能な場所
- **上部**: 後手の持ち駒
- **下部**: 先手の持ち駒
- **王手警告**: 赤色で「⚠️ 王手！」と表示
- **勝利表示**: 青色で「🎉 勝利！」と表示

### テストの実行

```bash
python test_shogi.py
```

## 勝利条件

### 詰み
- 相手の王将/玉将が王手されており、どの手を指しても王手を回避できない状態
- 詰みになったプレイヤーの負け

### 王手のルール
- 王将/玉将が相手の駒に攻撃されている状態
- 王手されている間は、王手を回避する手しか指せません
- 自分の王を王手に晒す手は指せません

## 実装されている駒の動き

- **歩兵**: 前に1マス
- **香車**: 前方直進
- **桂馬**: 前方に2マス進んで左右に1マス
- **銀将**: 前方3方向と斜め後方2方向
- **金将**: 前方3方向、左右、真後ろ
- **角行**: 斜め4方向
- **飛車**: 縦横4方向
- **王将/玉将**: 全方向1マス

### 成り駒

- **と金** (歩): 金将と同じ動き
- **成香** (香): 金将と同じ動き
- **成桂** (桂): 金将と同じ動き
- **成銀** (銀): 金将と同じ動き
- **龍王** (飛): 飛車 + 斜め1マス
- **龍馬** (角): 角行 + 縦横1マス

## 盤面表示（コマンドライン版）

```
  ９８７６５４３２１
  ──────────────────
1|v香v桂v銀v金v玉v金v銀v桂v香|1
2|  v飛      v角  |2
3|v歩v歩v歩v歩v歩v歩v歩v歩v歩|3
4|                  |4
5|                  |5
6|                  |6
7| 歩 歩 歩 歩 歩 歩 歩 歩 歩|7
8|   角      飛   |8
9| 香 桂 銀 金 王 金 銀 桂 香|9
  ──────────────────
  ９８７６５４３２１
```

- `v` が付いた駒は後手（上向き）
- 何も付いていない駒は先手（下向き）
- 先手は「王将」、後手は「玉将」を使用

## 制限事項

- 持ち駒からの打ち込みは未実装
- 二歩などの反則チェックは未実装
- AIプレイヤーは未実装

## 今後の拡張予定

- [x] 王手・詰みの判定 ✅ 実装済み
- [ ] 持ち駒からの打ち込み
- [ ] 反則チェック（二歩、打ち歩詰めなど）
- [ ] 簡単なAIプレイヤー
- [ ] 棋譜の保存・読み込み
- [ ] PyGame版の改良（音効果、アニメーション等）

## 動作環境

- Python 3.6以上
- PyGame 2.0以上（グラフィカル版のみ）

## スクリーンショット

PyGame版では以下の機能が利用できます：
- マウスによる直感的な操作
- 視覚的な駒の選択とハイライト
- リアルタイムでの盤面更新
- 持ち駒の表示
- 成り選択ダイアログ
- 王手・詰みの視覚的表示
- ゲーム終了後の再開機能
